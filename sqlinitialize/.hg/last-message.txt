Segmented functions and completed first version

